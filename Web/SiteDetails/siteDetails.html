<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D√©tails du site</title>
  <link rel="stylesheet" href="../style.css" />
  
  <!-- Leaflet CSS pour la carte -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <button id="backBtn">Retour</button>

  <main>
    <section class="active">
      <h1>D√©tails du site</h1>
      <div id="siteDetails"></div>

      <!-- Statistiques du site -->
      <div class="site-stats-container">
        <h3 class="stats-section-title">üìä Vue d'ensemble</h3>
        
        <div class="stats-grid-site">
          <!-- √âquipements -->
          <div class="stat-card-modern stat-card-info">
            <div class="stat-header">
              <span class="stat-icon-modern">üì¶</span>
              <span class="stat-label-modern">√âquipements</span>
            </div>
            <div class="stat-details">
              <div class="stat-main-value" id="statsEquipements">0</div>
              <div class="stat-breakdown">
                <div class="stat-item stat-success">
                  <span class="dot"></span>
                  <span class="label">OK</span>
                  <span class="value" id="statsOK">0</span>
                </div>
                <div class="stat-item stat-warning">
                  <span class="dot"></span>
                  <span class="label">Passable</span>
                  <span class="value" id="statsPassable">0</span>
                </div>
                <div class="stat-item stat-danger">
                  <span class="dot"></span>
                  <span class="label">NOK</span>
                  <span class="value" id="statsNOK">0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Maintenances -->
          <div class="stat-card-modern stat-card-primary">
            <div class="stat-header">
              <span class="stat-icon-modern">üîß</span>
              <span class="stat-label-modern">Maintenances</span>
            </div>
            <div class="stat-details">
              <div class="stat-main-value" id="statsMaintenances">0</div>
              <div class="stat-breakdown">
                <div class="stat-item stat-success">
                  <span class="dot"></span>
                  <span class="label">Termin√©es</span>
                  <span class="value" id="statsTerminees">0</span>
                </div>
                <div class="stat-item stat-warning">
                  <span class="dot"></span>
                  <span class="label">En cours</span>
                  <span class="value" id="statsEnCours">0</span>
                </div>
                <div class="stat-item stat-info">
                  <span class="dot"></span>
                  <span class="label">Planifi√©es</span>
                  <span class="value" id="statsPlanifiees">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Carte GPS -->
      <h3 class="map-title">üìç Localisation</h3>
      <div id="mapContainer">
        <div id="map"></div>
      </div>

      <details open>
        <summary>Maintenances</summary>
        <button class="primary" onclick="showAddMaintenanceForm()" style="margin: 1rem 0;">+ Ajouter une maintenance</button>
        <div id="MaintenancesList"></div>
      </details>

      <details open>
        <summary>√âquipements</summary>
        <button class="primary" onclick="showAddEquipementForm()" style="margin: 1rem 0;">+ Ajouter un √©quipement</button>
        <div id="EquipementsList"></div>
      </details>
    </section>
  </main>

  <!-- Formulaire ajout/modification maintenance -->
  <div id="addMaintenanceForm" class="modal">
    <form id="maintenanceForm" onsubmit="addMaintenance(event)">
      <h3 id="maintenanceFormTitle">Ajouter une maintenance</h3>
      <input type="date" id="maintenanceDate" required />
      <input type="text" id="maintenanceType" placeholder="Type de maintenance" required />
      <select id="maintenanceEtat">
        <option value="">-- √âtat --</option>
        <option value="Termin√©e">Termin√©e</option>
        <option value="En cours">En cours</option>
        <option value="Planifi√©e">Planifi√©e</option>
      </select>
      <input type="text" id="maintenanceDepartement" placeholder="D√©partement" />
      <textarea id="maintenanceCommentaire" placeholder="Commentaire"></textarea>
      <input type="text" id="maintenanceRI" placeholder="RI interne" />
      <button class="primary" type="submit" id="maintenanceSubmitBtn">Ajouter</button>
      <button type="button" onclick="hideAddMaintenanceForm()">Annuler</button>
    </form>
  </div>

  <!-- Formulaire ajout/modification √©quipement -->
  <div id="addEquipementForm" class="modal">
    <form id="equipementForm" onsubmit="addEquipement(event)">
      <h3 id="equipementFormTitle">Ajouter un √©quipement</h3>
      <input type="text" id="equipementNom" placeholder="Nom de l'√©quipement" required />
      <input type="text" id="equipementDepartement" placeholder="D√©partement" />
      <select id="equipementEtat">
        <option value="">-- √âtat --</option>
        <option value="OK">OK</option>
        <option value="NOK">NOK</option>
        <option value="Passable">Passable</option>
      </select>
      <textarea id="equipementDescription" placeholder="Description"></textarea>
      <button class="primary" type="submit" id="equipementSubmitBtn">Ajouter</button>
      <button type="button" onclick="hideAddEquipementForm()">Annuler</button>
    </form>
  </div>

  <!-- Leaflet JS pour la carte -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Modification de la fonction loadEquipements pour ajouter le bouton D√©tails
    const originalLoadEquipements = loadEquipements;
  </script>
  <script src="siteDetails.js" defer></script>
</body>
</html>