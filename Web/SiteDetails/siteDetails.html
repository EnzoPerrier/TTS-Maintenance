<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D√©tails du site</title>
  <link rel="stylesheet" href="../style.css" />
  
  <!-- Leaflet CSS pour la carte -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    /* ========================================
       FORMULAIRE MAINTENANCE ‚Äî MODAL
    ======================================== */
    .maintenance-form-modern {
      max-width: 1000px !important;
      width: 95% !important;
    }

    .maintenance-form-modern h3 {
      font-size: 1.6rem;
      margin-bottom: 1.5rem;
      color: var(--primary-blue);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-section {
      background: var(--gray-50);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--gray-200);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--primary-blue);
    }

    .section-icon { font-size: 1.4rem; }
    .section-header h4 { margin: 0; color: var(--primary-blue); font-size: 1.05rem; font-weight: 700; }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-row-3 { grid-template-columns: repeat(3, 1fr); }
    .form-row-4 { grid-template-columns: repeat(4, 1fr); }

    .form-group { display: flex; flex-direction: column; }
    .form-group.full-width { grid-column: 1 / -1; }

    .form-group label {
      margin-bottom: 0.4rem;
      font-weight: 500;
      color: var(--gray-700);
      font-size: 0.9rem;
    }

    .required-star { color: #e53e3e; margin-left: 2px; }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.7rem 0.85rem;
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-sm);
      font-size: 0.95rem;
      transition: var(--transition);
      background: var(--white);
      color: var(--gray-800);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
    }

    /* Reset checkbox inside checkbox-item ‚Äî must NOT inherit form-group input styles */
    .checkbox-item input[type="checkbox"] {
      all: revert;
      width: 18px !important;
      height: 18px !important;
      min-width: 18px !important;
      max-width: 18px !important;
      padding: 0 !important;
      border: revert !important;
      border-radius: 3px !important;
      background: revert !important;
      box-shadow: none !important;
      cursor: pointer;
      accent-color: var(--primary-blue);
      flex-shrink: 0;
      margin: 0;
    }

    /* Op√©rateurs */
    .operators-tags-input {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }

    .operators-hint {
      font-size: 0.8rem;
      color: var(--gray-500);
      margin-top: 0.3rem;
      font-style: italic;
    }

    /* Horaires 7 jours */
    .horaires-7jours { overflow-x: auto; }

    .horaires-7jours table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
      font-size: 0.88rem;
    }

    .horaires-7jours th {
      background: var(--primary-blue);
      color: white;
      padding: 0.5rem 0.6rem;
      text-align: center;
      font-weight: 600;
    }

    .horaires-7jours th:first-child { background: var(--gray-600); text-align: left; }

    .horaires-7jours td {
      padding: 0.35rem 0.4rem;
      border: 1px solid var(--gray-200);
      text-align: center;
    }

    .horaires-7jours tr:nth-child(even) td { background: var(--gray-50); }

    .horaires-7jours .period-sub {
      background: var(--gray-100);
      font-weight: 600;
      color: var(--gray-600);
      text-align: left;
      padding-left: 0.75rem;
    }

    .horaires-7jours input[type="time"] {
      border: 1px solid var(--gray-300);
      border-radius: 4px;
      padding: 0.3rem 0.4rem;
      font-size: 0.85rem;
      width: 100%;
      min-width: 80px;
      background: var(--white);
    }

    /* Nature des travaux */
    .travaux-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem;
    }

    .travaux-col { display: flex; flex-direction: column; gap: 0.5rem; }

    .checkbox-item {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.6rem;
      cursor: pointer;
      padding: 0.6rem 0.85rem;
      background: var(--white);
      border-radius: var(--radius-sm);
      border: 2px solid var(--gray-200);
      transition: var(--transition);
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--gray-800);
      user-select: none;
      box-sizing: border-box;
      width: 100%;
    }

    .checkbox-item:hover {
      border-color: var(--primary-blue);
      background: rgba(0,102,204,0.04);
    }

    .checkbox-item > span {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .checkbox-item.checked {
      border-color: var(--primary-blue);
      background: rgba(0,102,204,0.08);
    }

    .checkbox-item.checked {
      border-color: var(--primary-blue);
      background: rgba(0,102,204,0.08);
    }

    /* Garantie radio */
    .garantie-row {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .garantie-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      padding: 0.6rem 1.2rem;
      background: var(--white);
      border-radius: var(--radius-sm);
      border: 2px solid var(--gray-200);
      transition: var(--transition);
      font-weight: 500;
    }

    .garantie-option:hover { border-color: var(--primary-blue); background: rgba(0,102,204,0.04); }
    .garantie-option input { accent-color: var(--primary-blue); width: 16px; height: 16px; cursor: pointer; }

    /* Actions */
    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 2px solid var(--gray-200);
    }

    .form-actions button {
      flex: 1;
      padding: 0.875rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-secondary { background: var(--gray-600) !important; }
    .btn-secondary:hover { background: var(--gray-800) !important; }

    @media (max-width: 768px) {
      .form-row-3, .form-row-4 { grid-template-columns: 1fr 1fr; }
      .travaux-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 480px) {
      .form-row, .form-row-3, .form-row-4 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <button id="backBtn">‚Üê Retour</button>

  <main>
    <section class="active">
      <h1>üìç D√©tails du site</h1>
      <div id="siteDetails"></div>

      <!-- Statistiques du site -->
      <div class="site-stats-container">
        <h3 class="stats-section-title">üìä Vue d'ensemble</h3>
        
        <div class="stats-grid-site">
          <!-- √âquipements -->
          <div class="stat-card-modern stat-card-info">
            <div class="stat-header">
              <span class="stat-icon-modern">üì¶</span>
              <span class="stat-label-modern">√âquipements</span>
            </div>
            <div class="stat-details">
              <div class="stat-main-value" id="statsEquipements">0</div>
              <div class="stat-breakdown">
                <div class="stat-item stat-success">
                  <span class="dot"></span>
                  <span class="label">OK</span>
                  <span class="value" id="statsOK">0</span>
                </div>
                <div class="stat-item stat-warning">
                  <span class="dot"></span>
                  <span class="label">Passable</span>
                  <span class="value" id="statsPassable">0</span>
                </div>
                <div class="stat-item stat-danger">
                  <span class="dot"></span>
                  <span class="label">NOK</span>
                  <span class="value" id="statsNOK">0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Maintenances -->
          <div class="stat-card-modern stat-card-primary">
            <div class="stat-header">
              <span class="stat-icon-modern">üîß</span>
              <span class="stat-label-modern">Maintenances</span>
            </div>
            <div class="stat-details">
              <div class="stat-main-value" id="statsMaintenances">0</div>
              <div class="stat-breakdown">
                <div class="stat-item stat-success">
                  <span class="dot"></span>
                  <span class="label">Termin√©es</span>
                  <span class="value" id="statsTerminees">0</span>
                </div>
                <div class="stat-item stat-warning">
                  <span class="dot"></span>
                  <span class="label">En cours</span>
                  <span class="value" id="statsEnCours">0</span>
                </div>
                <div class="stat-item stat-info">
                  <span class="dot"></span>
                  <span class="label">Planifi√©es</span>
                  <span class="value" id="statsPlanifiees">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Carte GPS -->
      <h3 class="map-title">üìç Localisation</h3>
      <div id="mapContainer">
        <div id="map"></div>
      </div>

      <details open>
        <summary>üîß Maintenances</summary>
        <button class="primary" onclick="showAddMaintenanceForm()" style="margin: 1rem 0;">+ Ajouter une maintenance</button>
        <div id="MaintenancesList"></div>
      </details>

      <details open>
        <summary>üì¶ √âquipements</summary>
        <button class="primary" onclick="showAddEquipementForm()" style="margin: 1rem 0;">+ Ajouter un √©quipement</button>
        <div id="EquipementsList"></div>
      </details>
    </section>
  </main>

  <footer style="
    background: var(--gray-800, #2D3748);
    color: var(--white, #FFFFFF);
    text-align: center;
    padding: 1.5rem;
    margin-top: 3rem;
    border-top: 3px solid var(--primary-blue, #3B82F6);
  ">
    <a href="https://github.com/EnzoPerrier" target="_blank" rel="noopener noreferrer"
      style="color:var(--white,#FFFFFF);text-decoration:none;font-size:0.95rem;"
      onmouseover="this.style.color='var(--primary-blue,#3B82F6)'"
      onmouseout="this.style.color='var(--white,#FFFFFF)'">
      ¬© 2026 Enzo Perrier - Tous droits r√©serv√©s
    </a>
  </footer>

  <!-- =============================================
       MODAL AJOUT / MODIFICATION MAINTENANCE
  ============================================== -->
  <div id="addMaintenanceForm" class="modal">
    <form id="maintenanceForm" onsubmit="addMaintenance(event)" class="maintenance-form-modern">
      <h3 id="maintenanceFormTitle">üìã Ajouter une maintenance</h3>

      <!-- ‚îÄ‚îÄ IDENTIFICATION ‚îÄ‚îÄ -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-icon">ü™™</span>
          <h4>Identification</h4>
        </div>

        <div class="form-row form-row-3">
          <div class="form-group">
            <label for="maintenanceChrono">Chrono d'interv. <span class="required-star">*</span></label>
            <input type="text" id="maintenanceChrono" placeholder="Ex: RI251210" required />
          </div>
          <div class="form-group">
            <label for="maintenanceDateDemande">Date demande</label>
            <input type="date" id="maintenanceDateDemande" />
          </div>
          <div class="form-group">
            <label for="maintenanceClient">Client <span class="required-star">*</span></label>
            <input type="text" id="maintenanceClient" placeholder="Nom du client" required />
          </div>
        </div>

        <div class="form-row form-row-3">
          <div class="form-group">
            <label for="maintenanceDesignation">D√©sign. produit / site</label>
            <input type="text" id="maintenanceDesignation" placeholder="D√©signation produit ou site" />
          </div>
          <div class="form-group">
            <label for="maintenanceDateAccordClient">Date accord client</label>
            <input type="date" id="maintenanceDateAccordClient" />
          </div>
          <div class="form-group">
            <label for="maintenanceContact">Contact</label>
            <input type="text" id="maintenanceContact" placeholder="Nom du contact" />
          </div>
        </div>

        <div class="form-row form-row-3">
          <div class="form-group">
            <label for="maintenanceCategorie">Cat√©gorie <span class="required-star">*</span></label>
            <select id="maintenanceCategorie" required>
              <option value="">-- S√©lectionner --</option>
              <option value="Signalisation">Signalisation</option>
              <option value="√âclairage">√âclairage</option>
              <option value="S√©curit√©">S√©curit√©</option>
              <option value="Infrastructure">Infrastructure</option>
              <option value="Autre">Autre</option>
            </select>
          </div>
          <div class="form-group">
            <label for="maintenanceDate">Date intervention</label>
            <input type="date" id="maintenanceDate" />
          </div>
          <div class="form-group">
            <label for="maintenanceTypeProduit">Type panneau / produit</label>
            <input type="text" id="maintenanceTypeProduit" placeholder="Ex: TJT, PMV..." />
          </div>
        </div>

        <div class="form-row form-row-3">
          <div class="form-group">
            <label for="maintenanceTypeIntervention">Type d'intervention</label>
            <select id="maintenanceTypeIntervention">
              <option value="">-- S√©lectionner --</option>
              <option value="Installation">Installation</option>
              <option value="Intervention Curative">Intervention Curative</option>
              <option value="R√©vision">R√©vision</option>
              <option value="Contrat de maintenance">Contrat de maintenance</option>
              <option value="Autres">Autres</option>
            </select>
          </div>
          <div class="form-group">
            <label for="maintenanceDepartement">D√©partements</label>
            <input type="text" id="maintenanceDepartement" placeholder="Ex: 06, 13..." />
          </div>
          <div class="form-group">
            <label for="maintenanceNumeroCommande">N¬∞ D'affaire / CDE</label>
            <input type="text" id="maintenanceNumeroCommande" placeholder="N¬∞ Commande / Affaire" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="maintenanceEtat">√âtat</label>
            <select id="maintenanceEtat">
              <option value="">-- √âtat --</option>
              <option value="Planifi√©e">üìÖ Planifi√©e</option>
              <option value="En cours">‚öôÔ∏è En cours</option>
              <option value="Termin√©e">‚úÖ Termin√©e</option>
            </select>
          </div>
          <div class="form-group">
            <label for="commentaireMaintenance">Commentaire</label>
            <textarea id="commentaireMaintenance" placeholder="Commentaire interne..." rows="2"></textarea>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ OP√âRATEURS ‚îÄ‚îÄ -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-icon">üë∑</span>
          <h4>Personnes affect√©es</h4>
        </div>
        <div class="form-group">
          <label for="maintenanceOperateurs">Initiales des op√©rateurs</label>
          <textarea id="maintenanceOperateurs" class="operators-tags-input"
            placeholder="Saisir les initiales, appuyer sur Entr√©e entre chaque personne&#10;Ex: VM&#10;JD&#10;ML_H (suffixe _H = hotline)"></textarea>
          <span class="operators-hint">üí° S√©parer chaque personne par la touche "Entr√©e". Ajouter _H √† la fin pour indiquer une hotline (ex: VM_H)</span>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ HORAIRES 7 JOURS ‚îÄ‚îÄ -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-icon">üïê</span>
          <h4>Horaires d'intervention ‚Äî Matin ‚òÄÔ∏è &amp; Apr√®s-midi üå§Ô∏è</h4>
        </div>
        <div class="horaires-7jours">
          <table>
            <thead>
              <tr>
                <th style="min-width:90px;"></th>
                <th>LUNDI</th>
                <th>MARDI</th>
                <th>MERCREDI</th>
                <th>JEUDI</th>
                <th>VENDREDI</th>
                <th>SAMEDI</th>
                <th>DIMANCHE</th>
              </tr>
            </thead>
            <tbody>
              <tr><td class="period-sub" colspan="8">‚òÄÔ∏è Matin</td></tr>
              <tr>
                <td class="period-sub">Arriv√©e</td>
                <td><input type="time" id="add_lundi_matin_arr" /></td>
                <td><input type="time" id="add_mardi_matin_arr" /></td>
                <td><input type="time" id="add_mercredi_matin_arr" /></td>
                <td><input type="time" id="add_jeudi_matin_arr" /></td>
                <td><input type="time" id="add_vendredi_matin_arr" /></td>
                <td><input type="time" id="add_samedi_matin_arr" /></td>
                <td><input type="time" id="add_dimanche_matin_arr" /></td>
              </tr>
              <tr>
                <td class="period-sub">D√©part</td>
                <td><input type="time" id="add_lundi_matin_dep" /></td>
                <td><input type="time" id="add_mardi_matin_dep" /></td>
                <td><input type="time" id="add_mercredi_matin_dep" /></td>
                <td><input type="time" id="add_jeudi_matin_dep" /></td>
                <td><input type="time" id="add_vendredi_matin_dep" /></td>
                <td><input type="time" id="add_samedi_matin_dep" /></td>
                <td><input type="time" id="add_dimanche_matin_dep" /></td>
              </tr>
              <tr><td class="period-sub" colspan="8">üå§Ô∏è Apr√®s-midi</td></tr>
              <tr>
                <td class="period-sub">Arriv√©e</td>
                <td><input type="time" id="add_lundi_apm_arr" /></td>
                <td><input type="time" id="add_mardi_apm_arr" /></td>
                <td><input type="time" id="add_mercredi_apm_arr" /></td>
                <td><input type="time" id="add_jeudi_apm_arr" /></td>
                <td><input type="time" id="add_vendredi_apm_arr" /></td>
                <td><input type="time" id="add_samedi_apm_arr" /></td>
                <td><input type="time" id="add_dimanche_apm_arr" /></td>
              </tr>
              <tr>
                <td class="period-sub">D√©part</td>
                <td><input type="time" id="add_lundi_apm_dep" /></td>
                <td><input type="time" id="add_mardi_apm_dep" /></td>
                <td><input type="time" id="add_mercredi_apm_dep" /></td>
                <td><input type="time" id="add_jeudi_apm_dep" /></td>
                <td><input type="time" id="add_vendredi_apm_dep" /></td>
                <td><input type="time" id="add_samedi_apm_dep" /></td>
                <td><input type="time" id="add_dimanche_apm_dep" /></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ NATURE DES TRAVAUX ‚îÄ‚îÄ -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-icon">‚ö†Ô∏è</span>
          <h4>Nature des travaux</h4>
        </div>

        <div class="travaux-grid">
          <div class="travaux-col">
            <label class="checkbox-item">
              <input type="checkbox" id="add_chk_installation" value="Installation" onchange="toggleCheckedClass(this)" />
              <span>Installation</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" id="add_chk_curative" value="Intervention Curative" onchange="toggleCheckedClass(this)" />
              <span>Intervention Curative</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" id="add_chk_revision" value="R√©vision" onchange="toggleCheckedClass(this)" />
              <span>R√©vision</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" id="add_chk_autres_g" value="Autres" onchange="toggleCheckedClass(this)" />
              <span>Autres</span>
            </label>
          </div>
          <div class="travaux-col">
            <label class="checkbox-item">
              <input type="checkbox" id="add_chk_contrat" value="Contrat de maintenance" onchange="toggleCheckedClass(this)" />
              <span>Contrat de maintenance</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" id="add_chk_autres_d" value="Autres" onchange="toggleCheckedClass(this)" />
              <span>Autres</span>
            </label>
          </div>
        </div>

        <div style="margin-top: 1.25rem;">
          <label style="display:block; font-weight:600; color:var(--gray-700); margin-bottom:0.5rem;">Garantie</label>
          <div class="garantie-row">
            <label class="garantie-option">
              <input type="radio" name="maintenanceGarantie" id="addGarantieOui" value="Oui" />
              ‚úÖ Oui
            </label>
            <label class="garantie-option">
              <input type="radio" name="maintenanceGarantie" id="addGarantieNon" value="Non" checked />
              ‚ùå Non
            </label>
          </div>
        </div>
      </div>

      <!-- Boutons -->
      <div class="form-actions">
        <button class="primary" type="submit" id="maintenanceSubmitBtn">
          <span>‚úì</span> <span id="maintenanceSubmitLabel">Ajouter</span>
        </button>
        <button type="button" onclick="hideAddMaintenanceForm()" class="btn-secondary">
          <span>‚úï</span> Annuler
        </button>
      </div>
    </form>
  </div>

  <!-- Formulaire ajout/modification √©quipement -->
  <div id="addEquipementForm" class="modal">
    <form id="equipementForm" onsubmit="addEquipement(event)">
      <h3 id="equipementFormTitle">Ajouter un √©quipement</h3>
      <input type="text" id="equipementNom" placeholder="Nom de l'√©quipement" required />
      <input type="text" id="equipementDepartement" placeholder="D√©partement" />
      <select id="equipementEtat">
        <option value="">-- √âtat --</option>
        <option value="OK">OK</option>
        <option value="NOK">NOK</option>
        <option value="Passable">Passable</option>
      </select>
      <textarea id="equipementDescription" placeholder="Description"></textarea>
      <button class="primary" type="submit" id="equipementSubmitBtn">Ajouter</button>
      <button type="button" onclick="hideAddEquipementForm()">Annuler</button>
    </form>
  </div>

  <!-- Leaflet JS pour la carte -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="siteDetails.js" defer></script>
</body>
</html>